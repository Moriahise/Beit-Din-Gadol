<script>
  let currentLanguage = 'he';
  function toggleLanguage(){
    currentLanguage = currentLanguage === 'he' ? 'en' : 'he';
    document.documentElement.lang = currentLanguage;
    document.body.dir = currentLanguage === 'he' ? 'rtl' : 'ltr';
  }

  function getParam(name){
    const url = new URL(window.location.href);
    return url.searchParams.get(name);
  }

  async function loadQA(){
    const id = getParam('id');

    const card = document.querySelector('.qa-card');
    const empty = document.getElementById('emptyState');

    if(!id){
      card.style.display = 'none';
      empty.style.display = 'block';
      return;
    }

    try{
      // âœ… IMPORTANT: load the JSON from the real location
      const res = await fetch('data/qa/05yeshiva-qa-database-2025-12-11.json', { cache: 'no-store' });
      const data = await res.json();

      // âœ… Support both formats: {questions:[...]} or {items:[...]}
      const list = (data.questions || data.items || []);

      // âœ… Robust ID match (string compare)
      const item = list.find(q => String(q.id).trim() === String(id).trim());

      if(!item){
        card.style.display = 'none';
        empty.style.display = 'block';
        return;
      }

      document.getElementById('qaTitle').textContent = item.title || ('×©××œ×” #' + id);

      const meta = item.metadata || {};
      const dt = meta.date ? new Date(meta.date) : null;
      const dateStr = dt ? dt.toLocaleDateString('he-IL') : '';

      const parts = [];
      if(dateStr) parts.push('ğŸ“… ' + dateStr);
      if(meta.rabbi) parts.push('ğŸ‘¤ ' + meta.rabbi);
      if(typeof meta.upvotes !== 'undefined') parts.push('ğŸ‘ ' + meta.upvotes);
      document.getElementById('qaMeta').textContent = parts.join('   |   ');

      document.getElementById('qaQuestion').textContent = item.question || '';
      document.getElementById('qaAnswer').textContent = item.answer || '';

      const link = document.getElementById('qaSourceLink');
      link.href = item.url || ('https://www.yeshiva.org.il/ask/' + id);

    } catch(e){
      console.error(e);
      card.style.display = 'none';
      empty.style.display = 'block';
    }
  }

  document.addEventListener('DOMContentLoaded', loadQA);
</script>
